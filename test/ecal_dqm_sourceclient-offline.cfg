process ECALDQM = { 

include "EventFilter/EcalRawToDigiDev/data/EcalUnpackerMapping.cfi"

module ecalDigis = ecalEBunpacker from "EventFilter/EcalRawToDigiDev/data/EcalUnpackerData.cfi"

include "RecoLocalCalo/EcalRecProducers/data/ecalWeightUncalibRecHit.cfi"
include "RecoLocalCalo/EcalRecProducers/data/ecalFixedAlphaBetaFitUncalibRecHit.cfi"

include "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"

include "DQMOffline/Ecal/data/ecal_dqm_sourceclient-offline.cff"

include "SimCalorimetry/EcalTrigPrimProducers/data/ecalTriggerPrimitiveDigis.cff"
include "Geometry/EcalMapping/data/EcalMapping.cfi"

     replace ecalTriggerPrimitiveDigis.Label = "ecalDigis"
     replace ecalTriggerPrimitiveDigis.InstanceEB = "ebDigis"
     replace ecalTriggerPrimitiveDigis.InstanceEE = "eeDigis"
     replace ecalTriggerPrimitiveDigis.BarrelOnly = true

     replace EcalTrigPrimESProducer.DatabaseFileEB = "TPG_EB_MIPs.txt"
     replace EcalTrigPrimESProducer.DatabaseFileEE = "TPG_EE.txt"

     module preScaler = Prescaler{ int32 prescaleFactor = 1 }

include "RecoEcal/EgammaClusterProducers/data/ecalClusteringSequence.cff"

     module dqmSaverEB = DQMFileSaver{
       untracked string dirName = "."
       untracked string fileName = "EcalBarrel"
     }

     sequence ecalBarrelDataSequence = { preScaler,
                                         ecalDigis,
                                         ecalWeightUncalibRecHit,
                                         ecalFixedAlphaBetaFitUncalibRecHit,
                                         ecalRecHit,
                                         ecalTriggerPrimitiveDigis,
                                         islandBasicClusters,
                                         islandSuperClusters,
                                         hybridSuperClusters }

include "DQMServices/Components/data/MEtoEDMConverter.cfi"

     replace MEtoEDMConverter.Verbosity = 1
     replace MEtoEDMConverter.Frequency = 1

     path p = { ecalBarrelDataSequence,
                ecal_dqm_sourceclient-offline1,
                dqmSaverEB, MEtoEDMConverter }

     endpath q = { ecal_dqm_sourceclient-offline2 }

#     untracked PSet maxEvents = {untracked int32 input = -1}
     untracked PSet maxEvents = {untracked int32 input = 20}

     source = PoolSource{
       untracked vstring fileNames = { '/store/users/dellaric/data/GlobalAug07.00017123.root' }
     }

     module out1 = PoolOutputModule{
       untracked string fileName = 'dqm.root'
     }

     endpath o = { out1 }

     es_source = EcalTrivialConditionRetriever{
       untracked double adcToGeVEBConstant = 0.00875 # 0.035
       untracked vdouble amplWeights =        { -0.333, -0.333, -0.333,
                                                 0.000,  0.000,  1.000,
                                                 0.000,  0.000,  0.000,  0.000 }
       untracked vdouble amplWeightsAftGain = {  0.000,  0.000,  0.000,
                                                 0.000,  0.000,  1.000,
                                                 0.000,  0.000,  0.000,  0.000 }
       untracked vdouble pedWeights  =        {  0.333,  0.333,  0.333,
                                                 0.000,  0.000,  0.000,
                                                 0.000,  0.000,  0.000,  0.000 }
       untracked vdouble pedWeightsAft =      {  0.000,  0.000,  0.000,
                                                 0.000,  0.000,  0.000,
                                                 0.000,  0.000,  0.000,  0.000 }
       untracked vdouble jittWeights =        {  0.041,  0.041,  0.041,
                                                 0.000,  1.325, -0.050,
                                                -0.504, -0.502, -0.390,  0.000 }
       untracked vdouble jittWeightsAft =     {  0.000,  0.000,  0.000,
                                                 0.000,  1.098, -0.046,
                                                -0.416, -0.419, -0.337,  0.000 }
     }

include "CalibCalorimetry/EcalLaserCorrection/data/ecalLaserCorrectionService.cfi"

include "FWCore/MessageLogger/data/MessageLogger.cfi"

# old DQMServices

     service = DaqMonitorROOTBackEnd{
       untracked int32 verbose = 0
     }

# new DQMServices

#include "DQMServices/Core/data/DQM.cfg"
#
#     replace DQM.collectorHost = ""

}
